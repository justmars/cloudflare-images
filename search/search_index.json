{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Cloudflare Images","text":"<p>Cloudflare Images is a Paid Service</p> <p>Pricing:</p> <ul> <li>$5 per month per 100k images stored</li> <li>$1 per month per 100k images delivered</li> </ul>"},{"location":"#api-v1","title":"API v1","text":"<p>             Bases: <code>CF</code></p> <p>Need to setup a Cloudflare Images account to use. See Cloudflare Images docs. With required variables secured:</p> Field in .env Cloudflare API Credential Where credential found <code>CF_ACCT_ID</code> Account ID <code>https://dash.cloudflare.com/&lt;acct_id&gt;/images/images</code> <code>CF_IMG_HASH</code> Account Hash <code>https://dash.cloudflare.com/&lt;acct_id&gt;/images/images</code> <code>CF_IMG_TOKEN</code> API Secret Generate / save via <code>https://dash.cloudflare.com/&lt;acct_id&gt;/profile/api-tokens</code> <p>Add secrets to .env file and use as follows:</p> <p>Examples:</p> Example Usage<pre><code>&gt;&gt;&gt; cf = CloudflareImagesAPIv1() # will error out since missing key values\nTraceback (most recent call last):\npydantic_core._pydantic_core.ValidationError: 3 validation errors for CloudflareImagesAPIv1\nCF_ACCT_ID\nField required [type=missing, input_value={}, input_type=dict]\nFor further information visit https://errors.pydantic.dev/2.3/v/missing\nCF_IMG_HASH\nField required [type=missing, input_value={}, input_type=dict]\nFor further information visit https://errors.pydantic.dev/2.3/v/missing\nCF_IMG_TOKEN\nField required [type=missing, input_value={}, input_type=dict]\nFor further information visit https://errors.pydantic.dev/2.3/v/missing\n&gt;&gt;&gt; import os\n&gt;&gt;&gt; os.environ['CF_ACCT_ID'] = \"ABC\"\n&gt;&gt;&gt; cf = CloudflareImagesAPIv1() # will error out since still missing other values\nTraceback (most recent call last):\npydantic_core._pydantic_core.ValidationError: 2 validation errors for CloudflareImagesAPIv1\nCF_IMG_HASH\nField required [type=missing, input_value={'CF_ACCT_ID': 'ABC'}, input_type=dict]\nFor further information visit https://errors.pydantic.dev/2.3/v/missing\nCF_IMG_TOKEN\nField required [type=missing, input_value={'CF_ACCT_ID': 'ABC'}, input_type=dict]\nFor further information visit https://errors.pydantic.dev/2.3/v/missing\n&gt;&gt;&gt; # we'll add all the values needed\n&gt;&gt;&gt; os.environ['CF_IMG_HASH'], os.environ['CF_IMG_TOKEN'] = \"DEF\", \"XYZ\"\n&gt;&gt;&gt; cf = CloudflareImagesAPIv1() # no longer errors out\n&gt;&gt;&gt; CF.set_bearer_auth(cf.api_token)\n{'Authorization': 'Bearer XYZ'}\n&gt;&gt;&gt; cf.base_api\n'https://api.cloudflare.com/client/v4/accounts/ABC/images/v1'\n&gt;&gt;&gt; cf.base_delivery\n'https://imagedelivery.net/DEF'\n&gt;&gt;&gt; cf.url('hi-bob', 'w=400,sharpen=3')\n'https://imagedelivery.net/DEF/hi-bob/w=400,sharpen=3'\n&gt;&gt;&gt; from pathlib import Path\n&gt;&gt;&gt; p = Path().cwd() / \"img\" / \"screenshot.png\"\n&gt;&gt;&gt; p.exists() # Sample image found in `/img/screenshot.png`\nTrue\n&gt;&gt;&gt; import io\n&gt;&gt;&gt; img = io.BytesIO(p.read_bytes())\n&gt;&gt;&gt; type(img)\n&lt;class '_io.BytesIO'&gt;\n&gt;&gt;&gt; # Can now use img in `cf.post('sample_id', img)`\n</code></pre> Source code in <code>cloudflare_images/api.py</code> Python<pre><code>class CloudflareImagesAPIv1(CF):\n\"\"\"\n    Need to setup a Cloudflare Images account to use. See Cloudflare Images [docs](https://developers.cloudflare.com/images/cloudflare-images/).\n    With required variables secured:\n    Field in .env | Cloudflare API Credential | Where credential found\n    :--|:--:|:--\n    `CF_ACCT_ID` | Account ID |  `https://dash.cloudflare.com/&lt;acct_id&gt;/images/images`\n    `CF_IMG_HASH` | Account Hash | `https://dash.cloudflare.com/&lt;acct_id&gt;/images/images`\n    `CF_IMG_TOKEN` | API Secret | Generate / save via `https://dash.cloudflare.com/&lt;acct_id&gt;/profile/api-tokens`\n    Add secrets to .env file and use as follows:\n    Examples:\n        ```py title=\"Example Usage\" linenums=\"1\"\n        &gt;&gt;&gt; cf = CloudflareImagesAPIv1() # will error out since missing key values\n        Traceback (most recent call last):\n        pydantic_core._pydantic_core.ValidationError: 3 validation errors for CloudflareImagesAPIv1\n        CF_ACCT_ID\n          Field required [type=missing, input_value={}, input_type=dict]\n            For further information visit https://errors.pydantic.dev/2.3/v/missing\n        CF_IMG_HASH\n          Field required [type=missing, input_value={}, input_type=dict]\n            For further information visit https://errors.pydantic.dev/2.3/v/missing\n        CF_IMG_TOKEN\n          Field required [type=missing, input_value={}, input_type=dict]\n            For further information visit https://errors.pydantic.dev/2.3/v/missing\n        &gt;&gt;&gt; import os\n        &gt;&gt;&gt; os.environ['CF_ACCT_ID'] = \"ABC\"\n        &gt;&gt;&gt; cf = CloudflareImagesAPIv1() # will error out since still missing other values\n        Traceback (most recent call last):\n        pydantic_core._pydantic_core.ValidationError: 2 validation errors for CloudflareImagesAPIv1\n        CF_IMG_HASH\n          Field required [type=missing, input_value={'CF_ACCT_ID': 'ABC'}, input_type=dict]\n            For further information visit https://errors.pydantic.dev/2.3/v/missing\n        CF_IMG_TOKEN\n          Field required [type=missing, input_value={'CF_ACCT_ID': 'ABC'}, input_type=dict]\n            For further information visit https://errors.pydantic.dev/2.3/v/missing\n        &gt;&gt;&gt; # we'll add all the values needed\n        &gt;&gt;&gt; os.environ['CF_IMG_HASH'], os.environ['CF_IMG_TOKEN'] = \"DEF\", \"XYZ\"\n        &gt;&gt;&gt; cf = CloudflareImagesAPIv1() # no longer errors out\n        &gt;&gt;&gt; CF.set_bearer_auth(cf.api_token)\n        {'Authorization': 'Bearer XYZ'}\n        &gt;&gt;&gt; cf.base_api\n        'https://api.cloudflare.com/client/v4/accounts/ABC/images/v1'\n        &gt;&gt;&gt; cf.base_delivery\n        'https://imagedelivery.net/DEF'\n        &gt;&gt;&gt; cf.url('hi-bob', 'w=400,sharpen=3')\n        'https://imagedelivery.net/DEF/hi-bob/w=400,sharpen=3'\n        &gt;&gt;&gt; from pathlib import Path\n        &gt;&gt;&gt; p = Path().cwd() / \"img\" / \"screenshot.png\"\n        &gt;&gt;&gt; p.exists() # Sample image found in `/img/screenshot.png`\n        True\n        &gt;&gt;&gt; import io\n        &gt;&gt;&gt; img = io.BytesIO(p.read_bytes())\n        &gt;&gt;&gt; type(img)\n        &lt;class '_io.BytesIO'&gt;\n        &gt;&gt;&gt; # Can now use img in `cf.post('sample_id', img)`\n        ```\n    \"\"\"  # noqa: E501\naccount_id: str = Field(\ndefault=...,\nrepr=False,\ntitle=\"Cloudflare Account ID\",\ndescription=\"Overrides the base setting by making this mandatory.\",\nvalidation_alias=\"CF_ACCT_ID\",\n)\ncf_img_hash: str = Field(\ndefault=...,\nrepr=False,\ntitle=\"Cloudflare Image Hash\",\ndescription=\"Assigned when you create a Cloudflare Images account\",\nvalidation_alias=\"CF_IMG_HASH\",\n)\napi_token: str = Field(\ndefault=...,\nrepr=False,\ntitle=\"Cloudflare Image API Token\",\ndescription=\"Secure token to perform API operations\",\nvalidation_alias=\"CF_IMG_TOKEN\",\n)\nclient_api_ver: str = Field(\ndefault=\"v4\",\ntitle=\"Cloudflare Client API Version\",\ndescription=\"Used in the middle of the URL in API requests.\",\nvalidation_alias=\"CLOUDFLARE_CLIENT_API_VERSION\",\n)\nimages_api_ver: str = Field(\ndefault=\"v1\",\ntitle=\"Cloudflare Images API Version\",\ndescription=\"Used at the end of URL in API requests.\",\nvalidation_alias=\"CLOUDFLARE_IMAGES_API_VERSION\",\n)\ntimeout: int = Field(\ndefault=60,\nvalidation_alias=\"CF_IMG_TOKEN_TIMEOUT\",\n)\n@property\ndef client(self):\nreturn httpx.Client(timeout=self.timeout)\n@property\ndef base_api(self) -&gt; str:\n\"\"\"Construct endpoint. See [formula](https://developers.cloudflare.com/images/cloudflare-images/api-request/).\n        Examples:\n            &gt;&gt;&gt; import os\n            &gt;&gt;&gt; os.environ['CF_ACCT_ID'] = \"ABC\"\n            &gt;&gt;&gt; os.environ['CF_IMG_HASH'], os.environ['CF_IMG_TOKEN'] = \"DEF\", \"XYZ\"\n            &gt;&gt;&gt; cf = CloudflareImagesAPIv1()\n            &gt;&gt;&gt; cf.base_api\n            'https://api.cloudflare.com/client/v4/accounts/ABC/images/v1'\n        Returns:\n            str: URL endpoint to make requests with the Cloudflare-supplied credentials.\n        \"\"\"\nreturn self.add_account_endpoint(\nf\"/{self.account_id}/images/{self.images_api_ver}\"\n)\n@property\ndef v2(self) -&gt; str:\n\"\"\"See updated [list API endpoint](https://developers.cloudflare.com/api/operations/cloudflare-images-list-images-v2).\n        Examples:\n            &gt;&gt;&gt; import os\n            &gt;&gt;&gt; os.environ['CF_ACCT_ID'] = \"ABC\"\n            &gt;&gt;&gt; os.environ['CF_IMG_HASH'], os.environ['CF_IMG_TOKEN'] = \"DEF\", \"XYZ\"\n            &gt;&gt;&gt; cf = CloudflareImagesAPIv1()\n            &gt;&gt;&gt; cf.v2_api\n            'https://api.cloudflare.com/client/v4/accounts/ABC/images/v2'\n        \"\"\"\nreturn self.add_account_endpoint(f\"/{self.account_id}/images/v2\")\n@property\ndef base_delivery(self):\n\"\"\"Images are served with the following format: `https://imagedelivery.net/&lt;ACCOUNT_HASH&gt;/&lt;IMAGE_ID&gt;/&lt;VARIANT_NAME&gt;`\n        This property constructs the first part: `https://imagedelivery.net/&lt;ACCOUNT_HASH&gt;`\n        See Cloudflare [docs](https://developers.cloudflare.com/images/cloudflare-images/serve-images/).\n        Examples:\n        &gt;&gt;&gt; import os\n            &gt;&gt;&gt; os.environ['CF_ACCT_ID'] = \"ABC\"\n            &gt;&gt;&gt; os.environ['CF_IMG_HASH'], os.environ['CF_IMG_TOKEN'] = \"DEF\", \"XYZ\"\n            &gt;&gt;&gt; cf = CloudflareImagesAPIv1()\n            &gt;&gt;&gt; cf.base_delivery\n            'https://imagedelivery.net/DEF'\n        \"\"\"  # noqa: E501\nreturn \"/\".join([CF_DELIVER, self.cf_img_hash])\ndef url(self, img_id: str, variant: str = \"public\") -&gt; str:\n\"\"\"Generates url based on the Cloudflare hash of the account. The `variant` is based on\n        how these are customized on Cloudflare Images. See also flexible variant [docs](https://developers.cloudflare.com/images/cloudflare-images/transform/flexible-variants/)\n        Examples:\n            &gt;&gt;&gt; import os\n            &gt;&gt;&gt; os.environ['CF_ACCT_ID'] = \"ABC\"\n            &gt;&gt;&gt; os.environ['CF_IMG_HASH'], os.environ['CF_IMG_TOKEN'] = \"DEF\", \"XYZ\"\n            &gt;&gt;&gt; cf = CloudflareImagesAPIv1()\n            &gt;&gt;&gt; cf.url('sample-img', 'avatar')\n            'https://imagedelivery.net/DEF/sample-img/avatar'\n        Args:\n            img_id (str): The uploaded ID\n            variant (str, optional): The variant created in the Cloudflare Images dashboard. Defaults to \"public\".\n        Returns:\n            str: URL to display the request `img_id` with `variant`.\n        \"\"\"  # noqa: E501\nreturn \"/\".join([self.base_delivery, img_id, variant])\ndef get(self, img_id: str, *args, **kwargs) -&gt; httpx.Response:\n\"\"\"Issue httpx GET request to the image found in storage. Assuming request like\n        `CFImage().get('target-img-id')`, returns a response with metadata:\n        Examples:\n            ```py title=\"Response object from Cloudflare Images\"\n            &gt;&gt;&gt; # CFImage().get('target-img-id') commented out since hypothetical\n            b'{\n                \"result\": {\n                    \"id\": \"target-img-id\",\n                    \"filename\": \"target-img-id\",\n                    \"uploaded\": \"2023-02-20T09:09:41.755Z\",\n                    \"requireSignedURLs\": false,\n                    \"variants\": [\n                        \"https://imagedelivery.net/&lt;hash&gt;/&lt;target-img-id&gt;/public\",\n                        \"https://imagedelivery.net/&lt;hash&gt;/&lt;target-img-id&gt;/cover\",\n                        \"https://imagedelivery.net/&lt;hash&gt;/&lt;target-img-id&gt;/avatar\",\n                        \"https://imagedelivery.net/&lt;hash&gt;/&lt;target-img-id&gt;/uniform\"\n                    ]\n                },\n                \"success\": true,\n                \"errors\": [],\n                \"messages\": []\n            }'\n            ```\n        \"\"\"\nreturn self.client.get(\nurl=f\"{self.base_api}/{img_id}\",\nheaders=CF.set_bearer_auth(self.api_token),\n*args,\n**kwargs,\n)\ndef delete(self, img_id: str, *args, **kwargs) -&gt; httpx.Response:\n\"\"\"Issue httpx [DELETE](https://developers.cloudflare.com/images/cloudflare-images/transform/delete-images/) request to the image.\"\"\"  # noqa: E501\nreturn self.client.delete(\nurl=f\"{self.base_api}/{img_id}\",\nheaders=CF.set_bearer_auth(self.api_token),\n*args,\n**kwargs,\n)\ndef post(self, img_id: str, img: bytes, *args, **kwargs) -&gt; httpx.Response:\n\"\"\"Issue httpx [POST](https://developers.cloudflare.com/images/cloudflare-images/upload-images/upload-via-url/) request to upload image.\"\"\"  # noqa: E501\nreturn self.client.post(\nurl=self.base_api,\nheaders=CF.set_bearer_auth(self.api_token),\ndata={\"id\": img_id},\nfiles={\"file\": (img_id, img)},\n*args,\n**kwargs,\n)\ndef upsert(self, img_id: str, img: bytes) -&gt; httpx.Response:\n\"\"\"Ensures a unique id name by first deleting the `img_id` from storage and then\n        uploading the `img`.\"\"\"\nself.delete(img_id)\nreturn self.post(img_id, img)\ndef list_images(\nself,\nper_page: int = 1000,\nsort_order: str = \"desc\",\ncontinuation_token: str | None = None,\n) -&gt; httpx.Response:\n\"\"\"See [list images API](https://developers.cloudflare.com/api/operations/cloudflare-images-list-images-v2).\n        Args:\n            per_page (int, optional): Number of items per page (10 to 10,000). Defaults to 1000.\n            sort_order (str, optional): Sorting order by upload time (asc | desc). Defaults to \"desc\".\n            continuation_token (str | None, optional): Continuation token for a next page. List images V2 returns continuation_token. Defaults to None.\n        Returns:\n            httpx.Response: Contains top-level fields for `success`, `errors`, `messages` and the `result`.\n        \"\"\"  # noqa: E501\nif per_page &lt; 10 or per_page &gt; 10000:\nraise Exception(f\"Improper {per_page=}\")\nif sort_order not in [\"asc\", \"desc\"]:\nraise Exception(f\"Improper {sort_order=}\")\nparams = {\"per_page\": per_page, \"sort_order\": sort_order}\nif continuation_token:\nparams[\"continuation_token\"] = continuation_token\nqs = urlencode(params)\nreturn self.client.get(\nurl=f\"{self.v2}?{qs}\", headers=CF.set_bearer_auth(self.api_token)\n)\n</code></pre>"},{"location":"#cloudflare_images.api.CloudflareImagesAPIv1-attributes","title":"Attributes","text":""},{"location":"#cloudflare_images.api.CloudflareImagesAPIv1.base_api","title":"<code>base_api: str</code>  <code>property</code>","text":"<p>Construct endpoint. See formula.</p> <p>Examples:</p> Python Console Session<pre><code>&gt;&gt;&gt; import os\n&gt;&gt;&gt; os.environ['CF_ACCT_ID'] = \"ABC\"\n&gt;&gt;&gt; os.environ['CF_IMG_HASH'], os.environ['CF_IMG_TOKEN'] = \"DEF\", \"XYZ\"\n&gt;&gt;&gt; cf = CloudflareImagesAPIv1()\n&gt;&gt;&gt; cf.base_api\n'https://api.cloudflare.com/client/v4/accounts/ABC/images/v1'\n</code></pre> <p>Returns:</p> Name Type Description <code>str</code> <code>str</code> <p>URL endpoint to make requests with the Cloudflare-supplied credentials.</p>"},{"location":"#cloudflare_images.api.CloudflareImagesAPIv1.base_delivery","title":"<code>base_delivery</code>  <code>property</code>","text":"<p>Images are served with the following format: <code>https://imagedelivery.net/&lt;ACCOUNT_HASH&gt;/&lt;IMAGE_ID&gt;/&lt;VARIANT_NAME&gt;</code></p> <p>This property constructs the first part: <code>https://imagedelivery.net/&lt;ACCOUNT_HASH&gt;</code></p> <p>See Cloudflare docs.</p> <p>Examples:</p> <p>import os     &gt;&gt;&gt; os.environ['CF_ACCT_ID'] = \"ABC\"     &gt;&gt;&gt; os.environ['CF_IMG_HASH'], os.environ['CF_IMG_TOKEN'] = \"DEF\", \"XYZ\"     &gt;&gt;&gt; cf = CloudflareImagesAPIv1()     &gt;&gt;&gt; cf.base_delivery     'https://imagedelivery.net/DEF'</p>"},{"location":"#cloudflare_images.api.CloudflareImagesAPIv1.v2","title":"<code>v2: str</code>  <code>property</code>","text":"<p>See updated list API endpoint.</p> <p>Examples:</p> Python Console Session<pre><code>&gt;&gt;&gt; import os\n&gt;&gt;&gt; os.environ['CF_ACCT_ID'] = \"ABC\"\n&gt;&gt;&gt; os.environ['CF_IMG_HASH'], os.environ['CF_IMG_TOKEN'] = \"DEF\", \"XYZ\"\n&gt;&gt;&gt; cf = CloudflareImagesAPIv1()\n&gt;&gt;&gt; cf.v2_api\n'https://api.cloudflare.com/client/v4/accounts/ABC/images/v2'\n</code></pre>"},{"location":"#cloudflare_images.api.CloudflareImagesAPIv1-functions","title":"Functions","text":""},{"location":"#cloudflare_images.api.CloudflareImagesAPIv1.delete","title":"<code>delete(img_id, *args, **kwargs)</code>","text":"<p>Issue httpx DELETE request to the image.</p> Source code in <code>cloudflare_images/api.py</code> Python<pre><code>def delete(self, img_id: str, *args, **kwargs) -&gt; httpx.Response:\n\"\"\"Issue httpx [DELETE](https://developers.cloudflare.com/images/cloudflare-images/transform/delete-images/) request to the image.\"\"\"  # noqa: E501\nreturn self.client.delete(\nurl=f\"{self.base_api}/{img_id}\",\nheaders=CF.set_bearer_auth(self.api_token),\n*args,\n**kwargs,\n)\n</code></pre>"},{"location":"#cloudflare_images.api.CloudflareImagesAPIv1.get","title":"<code>get(img_id, *args, **kwargs)</code>","text":"<p>Issue httpx GET request to the image found in storage. Assuming request like <code>CFImage().get('target-img-id')</code>, returns a response with metadata:</p> <p>Examples:</p> Response object from Cloudflare Images<pre><code>&gt;&gt;&gt; # CFImage().get('target-img-id') commented out since hypothetical\nb'{\n\"result\": {\n\"id\": \"target-img-id\",\n\"filename\": \"target-img-id\",\n\"uploaded\": \"2023-02-20T09:09:41.755Z\",\n\"requireSignedURLs\": false,\n\"variants\": [\n\"https://imagedelivery.net/&lt;hash&gt;/&lt;target-img-id&gt;/public\",\n\"https://imagedelivery.net/&lt;hash&gt;/&lt;target-img-id&gt;/cover\",\n\"https://imagedelivery.net/&lt;hash&gt;/&lt;target-img-id&gt;/avatar\",\n\"https://imagedelivery.net/&lt;hash&gt;/&lt;target-img-id&gt;/uniform\"\n]\n},\n\"success\": true,\n\"errors\": [],\n\"messages\": []\n}'\n</code></pre> Source code in <code>cloudflare_images/api.py</code> Python<pre><code>def get(self, img_id: str, *args, **kwargs) -&gt; httpx.Response:\n\"\"\"Issue httpx GET request to the image found in storage. Assuming request like\n    `CFImage().get('target-img-id')`, returns a response with metadata:\n    Examples:\n        ```py title=\"Response object from Cloudflare Images\"\n        &gt;&gt;&gt; # CFImage().get('target-img-id') commented out since hypothetical\n        b'{\n            \"result\": {\n                \"id\": \"target-img-id\",\n                \"filename\": \"target-img-id\",\n                \"uploaded\": \"2023-02-20T09:09:41.755Z\",\n                \"requireSignedURLs\": false,\n                \"variants\": [\n                    \"https://imagedelivery.net/&lt;hash&gt;/&lt;target-img-id&gt;/public\",\n                    \"https://imagedelivery.net/&lt;hash&gt;/&lt;target-img-id&gt;/cover\",\n                    \"https://imagedelivery.net/&lt;hash&gt;/&lt;target-img-id&gt;/avatar\",\n                    \"https://imagedelivery.net/&lt;hash&gt;/&lt;target-img-id&gt;/uniform\"\n                ]\n            },\n            \"success\": true,\n            \"errors\": [],\n            \"messages\": []\n        }'\n        ```\n    \"\"\"\nreturn self.client.get(\nurl=f\"{self.base_api}/{img_id}\",\nheaders=CF.set_bearer_auth(self.api_token),\n*args,\n**kwargs,\n)\n</code></pre>"},{"location":"#cloudflare_images.api.CloudflareImagesAPIv1.list_images","title":"<code>list_images(per_page=1000, sort_order='desc', continuation_token=None)</code>","text":"<p>See list images API.</p> <p>Parameters:</p> Name Type Description Default <code>per_page</code> <code>int</code> <p>Number of items per page (10 to 10,000). Defaults to 1000.</p> <code>1000</code> <code>sort_order</code> <code>str</code> <p>Sorting order by upload time (asc | desc). Defaults to \"desc\".</p> <code>'desc'</code> <code>continuation_token</code> <code>str | None</code> <p>Continuation token for a next page. List images V2 returns continuation_token. Defaults to None.</p> <code>None</code> <p>Returns:</p> Type Description <code>Response</code> <p>httpx.Response: Contains top-level fields for <code>success</code>, <code>errors</code>, <code>messages</code> and the <code>result</code>.</p> Source code in <code>cloudflare_images/api.py</code> Python<pre><code>def list_images(\nself,\nper_page: int = 1000,\nsort_order: str = \"desc\",\ncontinuation_token: str | None = None,\n) -&gt; httpx.Response:\n\"\"\"See [list images API](https://developers.cloudflare.com/api/operations/cloudflare-images-list-images-v2).\n    Args:\n        per_page (int, optional): Number of items per page (10 to 10,000). Defaults to 1000.\n        sort_order (str, optional): Sorting order by upload time (asc | desc). Defaults to \"desc\".\n        continuation_token (str | None, optional): Continuation token for a next page. List images V2 returns continuation_token. Defaults to None.\n    Returns:\n        httpx.Response: Contains top-level fields for `success`, `errors`, `messages` and the `result`.\n    \"\"\"  # noqa: E501\nif per_page &lt; 10 or per_page &gt; 10000:\nraise Exception(f\"Improper {per_page=}\")\nif sort_order not in [\"asc\", \"desc\"]:\nraise Exception(f\"Improper {sort_order=}\")\nparams = {\"per_page\": per_page, \"sort_order\": sort_order}\nif continuation_token:\nparams[\"continuation_token\"] = continuation_token\nqs = urlencode(params)\nreturn self.client.get(\nurl=f\"{self.v2}?{qs}\", headers=CF.set_bearer_auth(self.api_token)\n)\n</code></pre>"},{"location":"#cloudflare_images.api.CloudflareImagesAPIv1.post","title":"<code>post(img_id, img, *args, **kwargs)</code>","text":"<p>Issue httpx POST request to upload image.</p> Source code in <code>cloudflare_images/api.py</code> Python<pre><code>def post(self, img_id: str, img: bytes, *args, **kwargs) -&gt; httpx.Response:\n\"\"\"Issue httpx [POST](https://developers.cloudflare.com/images/cloudflare-images/upload-images/upload-via-url/) request to upload image.\"\"\"  # noqa: E501\nreturn self.client.post(\nurl=self.base_api,\nheaders=CF.set_bearer_auth(self.api_token),\ndata={\"id\": img_id},\nfiles={\"file\": (img_id, img)},\n*args,\n**kwargs,\n)\n</code></pre>"},{"location":"#cloudflare_images.api.CloudflareImagesAPIv1.upsert","title":"<code>upsert(img_id, img)</code>","text":"<p>Ensures a unique id name by first deleting the <code>img_id</code> from storage and then uploading the <code>img</code>.</p> Source code in <code>cloudflare_images/api.py</code> Python<pre><code>def upsert(self, img_id: str, img: bytes) -&gt; httpx.Response:\n\"\"\"Ensures a unique id name by first deleting the `img_id` from storage and then\n    uploading the `img`.\"\"\"\nself.delete(img_id)\nreturn self.post(img_id, img)\n</code></pre>"},{"location":"#cloudflare_images.api.CloudflareImagesAPIv1.url","title":"<code>url(img_id, variant='public')</code>","text":"<p>Generates url based on the Cloudflare hash of the account. The <code>variant</code> is based on how these are customized on Cloudflare Images. See also flexible variant docs</p> <p>Examples:</p> Python Console Session<pre><code>&gt;&gt;&gt; import os\n&gt;&gt;&gt; os.environ['CF_ACCT_ID'] = \"ABC\"\n&gt;&gt;&gt; os.environ['CF_IMG_HASH'], os.environ['CF_IMG_TOKEN'] = \"DEF\", \"XYZ\"\n&gt;&gt;&gt; cf = CloudflareImagesAPIv1()\n&gt;&gt;&gt; cf.url('sample-img', 'avatar')\n'https://imagedelivery.net/DEF/sample-img/avatar'\n</code></pre> <p>Parameters:</p> Name Type Description Default <code>img_id</code> <code>str</code> <p>The uploaded ID</p> required <code>variant</code> <code>str</code> <p>The variant created in the Cloudflare Images dashboard. Defaults to \"public\".</p> <code>'public'</code> <p>Returns:</p> Name Type Description <code>str</code> <code>str</code> <p>URL to display the request <code>img_id</code> with <code>variant</code>.</p> Source code in <code>cloudflare_images/api.py</code> Python<pre><code>def url(self, img_id: str, variant: str = \"public\") -&gt; str:\n\"\"\"Generates url based on the Cloudflare hash of the account. The `variant` is based on\n    how these are customized on Cloudflare Images. See also flexible variant [docs](https://developers.cloudflare.com/images/cloudflare-images/transform/flexible-variants/)\n    Examples:\n        &gt;&gt;&gt; import os\n        &gt;&gt;&gt; os.environ['CF_ACCT_ID'] = \"ABC\"\n        &gt;&gt;&gt; os.environ['CF_IMG_HASH'], os.environ['CF_IMG_TOKEN'] = \"DEF\", \"XYZ\"\n        &gt;&gt;&gt; cf = CloudflareImagesAPIv1()\n        &gt;&gt;&gt; cf.url('sample-img', 'avatar')\n        'https://imagedelivery.net/DEF/sample-img/avatar'\n    Args:\n        img_id (str): The uploaded ID\n        variant (str, optional): The variant created in the Cloudflare Images dashboard. Defaults to \"public\".\n    Returns:\n        str: URL to display the request `img_id` with `variant`.\n    \"\"\"  # noqa: E501\nreturn \"/\".join([self.base_delivery, img_id, variant])\n</code></pre>"},{"location":"#django","title":"Django","text":"<p>             Bases: <code>Storage</code></p> <p>Custom Storage Class based on Django docs instructions</p> <p>Starting with Django 4.2, add to <code>STORAGES</code> setting:</p> Django settings.py<pre><code>...\nSTORAGES = {  # django 4.2 and above\n\"default\": {  # default\n\"BACKEND\": \"django.core.files.storage.FileSystemStorage\",\n},\n\"staticfiles\": {  # default\n\"BACKEND\": \"django.contrib.staticfiles.storage.StaticFilesStorage\",\n},\n\"cloudflare_images\": {  # add\n\"BACKEND\": \"cloudflare_images.django.ImageStorageCloudflare\",\n},\n}\n</code></pre> <p>Can then define a callable likeso:</p> For use in ImageField<pre><code>from django.core.files.storage import storages\ndef select_storage(is_remote_env: bool):\nreturn storages[\"cloudflare_images\"] if is_remote_env else storages[\"default\"]\nclass MyModel(models.Model):\nmy_img = models.ImageField(storage=select_storage)\n</code></pre> <p>Can also refer to it via:</p> Invocation<pre><code>from django.core.files.storage import storages\ncf = storages[\"cloudflare_images\"]\n# assume previous upload done\nid = &lt;image-id-uploaded&gt;\n# get image url, defaults to 'public' variant\ncf.url(id)\n# specified 'avatar' variant, assuming it was created in the Cloudflare Images dashboard / API\ncf.url_variant(id, 'avatar')\n</code></pre> Source code in <code>cloudflare_images/dj.py</code> Python<pre><code>@deconstructible\nclass LimitedStorageCloudflareImages(Storage):\n\"\"\"Custom Storage Class based on Django docs [instructions](https://docs.djangoproject.com/en/dev/howto/custom-file-storage/#django.core.files.storage._open)\n    Starting with Django 4.2, add to `STORAGES` setting:\n    ```python title=\"Django settings.py\" linenums=\"1\" hl_lines=\"9 10\"\n    ...\n    STORAGES = {  # django 4.2 and above\n        \"default\": {  # default\n            \"BACKEND\": \"django.core.files.storage.FileSystemStorage\",\n        },\n        \"staticfiles\": {  # default\n            \"BACKEND\": \"django.contrib.staticfiles.storage.StaticFilesStorage\",\n        },\n        \"cloudflare_images\": {  # add\n            \"BACKEND\": \"cloudflare_images.django.ImageStorageCloudflare\",\n        },\n    }\n    ```\n    Can then define a [callable](https://docs.djangoproject.com/en/dev/topics/files/#using-a-callable) likeso:\n    ```python title=\"For use in ImageField\"\n    from django.core.files.storage import storages\n    def select_storage(is_remote_env: bool):\n        return storages[\"cloudflare_images\"] if is_remote_env else storages[\"default\"]\n    class MyModel(models.Model):\n        my_img = models.ImageField(storage=select_storage)\n    ```\n    Can also refer to it via:\n    ```python title=\"Invocation\"\n    from django.core.files.storage import storages\n    cf = storages[\"cloudflare_images\"]\n    # assume previous upload done\n    id = &lt;image-id-uploaded&gt;\n    # get image url, defaults to 'public' variant\n    cf.url(id)\n    # specified 'avatar' variant, assuming it was created in the Cloudflare Images dashboard / API\n    cf.url_variant(id, 'avatar')\n    ```\n    \"\"\"  # noqa: E501\ndef __init__(self):\nsuper().__init__()\nself.api = CloudflareImagesAPIv1()\ndef __repr__(self):\nreturn \"&lt;LimitedToImagesStorageClassCloudflare&gt;\"\ndef _open(self, name: str, mode=\"rb\") -&gt; File:\nreturn File(self.api.get(img_id=name), name=name)\ndef _save(self, name: str, content: bytes) -&gt; str:\nres = self.api.upsert(name, content)\nreturn self.api.url(img_id=res.json()[\"result\"][\"id\"])\ndef get_valid_name(self, name):\nreturn name\ndef get_available_name(self, name, max_length=None):\nreturn self.generate_filename(name)\ndef generate_filename(self, filename):\nreturn filename\ndef delete(self, name) -&gt; httpx.Response:\nreturn self.api.delete(name)\ndef exists(self, name: str) -&gt; bool:\nres = self.api.get(name)\nif res.status_code == HTTPStatus.NOT_FOUND:\nreturn False\nelif res.status_code == HTTPStatus.OK:\nreturn True\nraise Exception(\"Image name found but http status code is not OK.\")\ndef listdir(self, path):\nraise NotImplementedError(\n\"subclasses of Storage must provide a listdir() method\"\n)\ndef size(self, name: str):\nreturn len(self.api.get(name).content)\ndef url(self, name: str):\nreturn self.api.url(name)\ndef url_variant(self, name: str, variant: str):\nreturn self.api.url(name, variant)\ndef get_accessed_time(self, name):\nraise NotImplementedError(\n\"subclasses of Storage must provide a get_accessed_time() method\"\n)\ndef get_created_time(self, name):\nraise NotImplementedError(\n\"subclasses of Storage must provide a get_created_time() method\"\n)\ndef get_modified_time(self, name):\nraise NotImplementedError(\n\"subclasses of Storage must provide a get_modified_time() method\"\n)\n</code></pre>"}]}